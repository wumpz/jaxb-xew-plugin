{"name":"Jaxb-xew-plugin","tagline":"JAXB @XmlElementWrapper Plugin","body":"# JAXB @XmlElementWrapper Plugin\r\n\r\n## Description\r\n\r\nThis JAXB plugin utilises the power of `@XmlElementWrapper` annotation. Originally `xjc` trends to create wrapper classes which are the containers for collections. This plugin goes through all properties to find ones which can be represented in the model in more optimal way.\r\n\r\n## The problem origin in details\r\n\r\nTo illustrate the problem let's take the following XSD:\r\n\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <xs:schema\r\n    \txmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\r\n    \txmlns:xml=\"http://www.w3.org/XML/1998/namespace\"\r\n    \telementFormDefault=\"qualified\">\r\n    \r\n    \t<xs:element name=\"order\">\r\n    \t\t<xs:complexType>\r\n    \t\t\t<xs:sequence>\r\n    \t\t\t\t<xs:element ref=\"items\" />\r\n    \t\t\t</xs:sequence>\r\n    \t\t</xs:complexType>\r\n    \t</xs:element>\r\n    \r\n    \t<xs:element name=\"items\">\r\n    \t\t<xs:complexType>\r\n    \t\t\t<xs:sequence>\r\n    \t\t\t\t<xs:element name=\"item\" type=\"xs:string\" maxOccurs=\"unbounded\" />\r\n    \t\t\t</xs:sequence>\r\n    \t\t</xs:complexType>\r\n    \t</xs:element>\r\n    </xs:schema>\r\n\r\nFrom this XSD by default `xjc` will generate two classes:\r\n\r\n    @XmlAccessorType(XmlAccessType.FIELD)\r\n    @XmlType(name = \"\", propOrder = { \"items\" })\r\n    @XmlRootElement(name = \"order\")\r\n    public class Order {\r\n    \r\n    \t@XmlElement(required = true)\r\n    \tprotected Items\titems;\r\n    \r\n    \tpublic Items getItems() {\r\n    \t\treturn items;\r\n    \t}\r\n    \r\n    \tpublic void setItems(Items value) {\r\n    \t\tthis.items = value;\r\n    \t}\r\n    }\r\n\r\nand\r\n\r\n    @XmlAccessorType(XmlAccessType.FIELD)\r\n    @XmlType(name = \"\", propOrder = { \"item\" })\r\n    @XmlRootElement(name = \"items\")\r\n    public class Items {\r\n    \r\n    \t@XmlElement(required = true)\r\n    \tprotected List<String>\titem;\r\n    \r\n    \tpublic List<String> getItem() {\r\n    \t\tif (item == null) {\r\n    \t\t\titem = new ArrayList<String>();\r\n    \t\t}\r\n    \t\treturn this.item;\r\n    \t}\r\n    }\r\n\r\nSo to access a particular item one need to write a but clumsy code `order.getItems().getItems().get(itemIndex)`. The solution is to use `@XmlElementWrapper` which cures exactly this case. The result will be only one class with direct access to items:\r\n\r\n    @XmlAccessorType(XmlAccessType.FIELD)\r\n    @XmlType(name = \"\", propOrder = { \"items\" })\r\n    @XmlRootElement(name = \"order\")\r\n    public class Order {\r\n    \r\n    \t@XmlElementWrapper(name = \"items\", required = true)\r\n    \t@XmlElement(name = \"item\")\r\n    \tprotected List<String>\titems;\r\n    \r\n    \tpublic List<String> getItems() {\r\n    \t\tif (items == null) {\r\n    \t\t\titems = new ArrayList<String>();\r\n    \t\t}\r\n    \t\treturn items;\r\n    \t}\r\n    \r\n    \tpublic void setItems(List<String> items) {\r\n    \t\tthis.items = items;\r\n    \t}\r\n    }\r\n\r\n## Usage\r\n\r\nThe plugin is used together with the `xjc` from the command line or from an Ant task or via `maven-jaxb2-plugin`.\r\n\r\nThe following options are applicable for plugin:\r\n\r\n<table>\r\n<tr>\r\n\t<th>Option</th>\r\n\t<th>Comment</th>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew</td>\r\n\t<td>Activate the XML Element Wrapper plugin</td>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew:include filename</td>\r\n\t<td>Specify a filename with candidate classes to include in the compilation.</td>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew:exclude filename</td>\r\n\t<td>Specify a filename with candidate classes to exclude from the compilation.</td>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew:summary filename</td>\r\n\t<td>Specify a filename to contain summary information on the compilation.</td>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew:collection FQCN</td>\r\n\t<td>Specify the class name of the collection type to use.</td>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew:instantiate [lazy|early]</td>\r\n\t<td>Specify when the collection class should be instantiated.</td>\r\n</tr>\r\n<tr>\r\n\t<td>-Xxew:delete</td>\r\n\t<td>Delete candidate classes having been replaced during compilation.</td>\r\n</tr>\r\n</table>\r\n\r\n### Episode file\r\n\r\nFor correct generation of episode file, the corresponding options should follow `-Xxew`, for example:\r\n\r\n`-Xxew ... -episode <file>`\r\n\r\nThis will trigger episode plugin after Xew plugin.\r\n\r\n### `fluent-api` and `value-constructor` plugins\r\n\r\nThese plugins should be activated after Xew plugin:\r\n\r\n`-Xxew ... -Xfluent-api -Xvalue-constructor` \r\n\r\nOtherwise if they are activated before Xew plugin cannot revert the changes they made.\r\n\r\n### Ant task\r\n\r\nFirst you need to download the plugin jar (for example, from [Maven repository](http://mirrors.ibiblio.org/pub/mirrors/maven2/com/github/jaxb-xew-plugin/jaxb-xew-plugin)) and put it to your project `lib` folder.\r\n\r\nTo use the plugin from Ant you will need something like the following in your build file:\r\n\r\n    <taskdef name=\"xjc\" classname=\"com.sun.tools.xjc.XJCTask\">\r\n    \t<classpath>\r\n    \t\t<fileset dir=\"${lib}/jaxb\" includes=\"*.jar\" />\r\n    \t\t<fileset dir=\"lib\" includes=\"jaxb-xew-plugin.jar\" />\r\n    \t</classpath>\r\n    </taskdef>\r\n    \r\n    <xjc destdir=\"${src-generated}\" package=\"dk.conspicio.example.xml2code.v2\">\r\n    \t<arg value=\"-Xxew\" />\r\n    \t<arg value=\"-Xxew:summary ${build}/xew-summary.txt\" />\r\n    \t<arg value=\"-Xxew:instantiate lazy\" />\r\n    \t<schema dir=\"xsd\" includes=\"*.xsd\" />\r\n    \t<binding dir=\"xsd\" includes=\"*.xjb\" />\r\n    </xjc>\r\n\r\n### Maven\r\n\r\n#### maven-jaxb2-plugin\r\n\r\nNote: `maven-jaxb2-plugin` prior to v0.8.0 was compiled against JAXB XJC API which is not compatible with this plugin. Version 0.8.1 is guaranteed to work, versions 0.8.2 and 0.8.3 should also work fine.\r\n\r\n    <plugin>\r\n    \t<groupId>org.jvnet.jaxb2.maven2</groupId>\r\n    \t<artifactId>maven-jaxb2-plugin</artifactId>\r\n    \t<version>0.8.1</version>\r\n    \t<executions>\r\n    \t\t<execution>\r\n    \t\t\t<phase>generate-sources</phase>\r\n    \t\t\t<goals>\r\n    \t\t\t\t<goal>generate</goal>\r\n    \t\t\t</goals>\r\n    \t\t\t<configuration>\r\n    \t\t\t\t<verbose>true</verbose>\r\n    \t\t\t\t<generateDirectory>${project.build.sourceDirectory}</generateDirectory>\r\n    \t\t\t\t<schemaDirectory>xsd</schemaDirectory>\r\n    \t\t\t\t<removeOldOutput>false</removeOldOutput>\r\n    \t\t\t\t<episode>false</episode>\r\n    \r\n    \t\t\t\t<extension>true</extension>\r\n    \t\t\t\t<args>\r\n    \t\t\t\t\t<arg>-no-header</arg>\r\n    \t\t\t\t\t<arg>-Xxew</arg>\r\n    \t\t\t\t\t<arg>-Xxew:instantiate lazy</arg>\r\n    \t\t\t\t\t<arg>-Xxew:delete</arg>\r\n    \t\t\t\t</args>\r\n    \t\t\t\t<plugins>\r\n    \t\t\t\t\t<plugin>\r\n    \t\t\t\t\t\t<groupId>com.github.jaxb-xew-plugin</groupId>\r\n    \t\t\t\t\t\t<artifactId>jaxb-xew-plugin</artifactId>\r\n    \t\t\t\t\t\t<version>1.0</version>\r\n    \t\t\t\t\t</plugin>\r\n    \t\t\t\t</plugins>\r\n    \t\t\t</configuration>\r\n    \t\t</execution>\r\n    \t</executions>\r\n    </plugin>\r\n\r\n#### jaxb2-maven-plugin\r\n\r\nNote: `jaxb2-maven-plugin` v1.5 was compiled against JAXB XJC API v2.1.13 which is not compatible with this plugin, thus additional dependency is needed to be added to **plugin classpath**.\r\n\r\n    <plugin>\r\n    \t<groupId>org.codehaus.mojo</groupId>\r\n    \t<artifactId>jaxb2-maven-plugin</artifactId>\r\n    \t<version>1.5</version>\r\n    \t<executions>\r\n    \t\t<execution>\r\n    \t\t\t<phase>generate-sources</phase>\r\n    \t\t\t<goals>\r\n    \t\t\t\t<goal>xjc</goal>\r\n    \t\t\t</goals>\r\n    \t\t\t<configuration>\r\n    \t\t\t\t<verbose>true</verbose>\r\n    \t\t\t\t<outputDirectory>${project.build.sourceDirectory}</outputDirectory>\r\n    \t\t\t\t<schemaDirectory>xsd</schemaDirectory>\r\n    \t\t\t\t<clearOutputDir>false</clearOutputDir>\r\n    \r\n    \t\t\t\t<extension>true</extension>\r\n    \t\t\t\t<arguments>-no-header -Xxew -Xxew:instantiate lazy -Xxew:delete</arguments>\r\n    \t\t\t</configuration>\r\n    \t\t</execution>\r\n    \t</executions>\r\n    \t<dependencies>\r\n    \t\t<dependency>\r\n    \t\t\t<groupId>com.github.jaxb-xew-plugin</groupId>\r\n    \t\t\t<artifactId>jaxb-xew-plugin</artifactId>\r\n    \t\t\t<version>1.0</version>\r\n    \t\t</dependency>\r\n    \t\t<!-- \r\n    \t\t | We need to update the jaxb-xjc plugin version from 2.1.13 to the 2.2.4-1 version \r\n    \t\t | used by the jaxb-xew-plugin (version 2.1.13 which does not have the required \r\n    \t\t | method com.suun.codemodel.JAnnotatable.annotations()Ljava/util/Collection).\r\n    \t\t -->\r\n    \t\t<dependency>\r\n    \t\t\t<groupId>com.sun.xml.bind</groupId>\r\n    \t\t\t<artifactId>jaxb-xjc</artifactId>\r\n    \t\t\t<version>2.2.4-1</version>\r\n    \t\t</dependency>\r\n    \t</dependencies>\r\n    </plugin>\r\n\r\nYou can find more examples of this plugin in [`samples`](samples/) directory.\r\n\r\n## What's new\r\n\r\n### v1.1\r\n\r\n* Plugin is re-worked. Bugs fixed (issue #1, #3, #6, #7). Some functionality is possible only by accessing private fields, so Xew plugin may not work in security-managed environment.\r\n* Testing framework introduced. XSD in [`com/sun/tools/xjc/addon/xew/`](src/test/resources/com/sun/tools/xjc/addon/xew/) directory can be used as reference.\r\n* Logging is done via `commons-logging`. Log level is configurable like this `mvn -Dorg.apache.commons.logging.simplelog.defaultlog=DEBUG`.\r\n\r\n### v1.0\r\n\r\nThe original code of Bjarne Hansen, with some fixes. \r\n\r\n## Contribution\r\n\r\nIf you have time and desire to contribute to this project you can do it in many ways:\r\n\r\n* Improve this very documentation.\r\n* Implement Unit tests.\r\n* Provide more samples.\r\n\r\n### Development\r\n\r\nEverybody is very welcomed to send patches by email. But the best way would be:\r\n\r\n- Fork the repository.\r\n- Apply the [formatting rules](#code-style) (the ones for Eclipse can be found in [`dist`](dist) folder).\r\n- Create a ticket in [bugtracker](https://github.com/dmak/jaxb-xew-plugin/issues). If applicable attach XSD that demonstrates the problem to the issue.\r\n- Create a branch referring the ticket number (`git branch issue-22`).\r\n- Do the changes.\r\n- Commit to your own fork, mentioning the ticket number in commit message (`Implemented nice feature (fixes #22)`). Check [here](https://github.com/blog/831-issues-2-0-the-next-generation) the commit message syntax sugar.\r\n- [Request for pull](http://help.github.com/send-pull-requests/).\r\n\r\nIf you provide the code in any way you automatically agree with a [project license](#license).\r\n\r\n#### Code style\r\n\r\n* There are no specific coding and naming conventions for this project except ones given in [Code Conventions for the Java Programming Language](http://www.oracle.com/technetwork/java/codeconv-138413.html) by Sun. Use best practices and common sense.\r\n* For [code formatting](dist/eclipse-code-formatting-rules.xml) basically Eclipse build-in formatting rules were used with following changes:\r\n  - Indentation → Align fields on columns: on\r\n  - Indentation → Tab policy: Mixed\r\n  - Indentation → Use spaces to indent wrapped lines: on\r\n  - Line Wrapping → Maximum line width: 120\r\n  - Line Wrapping → Default indentation for wrapped lines: 3\r\n  - Comments → Maximum line width for comments: 120\r\n  - Comments → Enable line comment formatting: off\r\n  - New Lines → Insert new line in empty anonymous class body: off\r\n  - New Lines → Insert new line in empty block: off\r\n* TAB is used for alignment for XML/XSD/... files. \r\n\r\n#### Release procedure\r\n\r\n* Read [Sonatype OSS Maven Repository Usage Guide](https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide) from cover to cover.\r\n* Use the following `settings.xml` for your Maven:\r\n\r\n        <settings>\r\n        \t<!-- Optional proxy configuration (if applicable to your environment) -->\r\n        \t<proxies>\r\n        \t\t<proxy>\r\n        \t\t\t<active>true</active>\r\n        \t\t\t<protocol>http</protocol>\r\n        \t\t\t<host>proxy</host>\r\n        \t\t\t<port>8080</port>\r\n        \t\t\t<nonProxyHosts>*.internal.domain</nonProxyHosts>\r\n        \t\t</proxy>\r\n        \t\t<proxy>\r\n        \t\t\t<active>true</active>\r\n        \t\t\t<protocol>https</protocol>\r\n        \t\t\t<host>proxy</host>\r\n        \t\t\t<port>8080</port>\r\n        \t\t\t<nonProxyHosts>*.internal.domain</nonProxyHosts>\r\n        \t\t</proxy>\r\n        \t</proxies>\r\n        \r\n        \t<servers>\r\n        \t\t<server>\r\n        \t\t\t<id>sonatype-nexus-snapshots</id>\r\n        \t\t\t<username>...sonatype_user...</username>\r\n        \t\t\t<password>...sonatype_password...</password>\r\n        \t\t</server>\r\n        \t\t<server>\r\n        \t\t\t<id>sonatype-nexus-staging</id>\r\n        \t\t\t<username>...sonatype_user...</username>\r\n        \t\t\t<password>...sonatype_password...</password>\r\n        \t\t</server>\r\n        \t</servers>\r\n        \r\n        \t<profiles>\r\n        \t\t<profile>\r\n        \t\t\t<id>gpg</id>\r\n        \t\t\t<properties>\r\n        \t\t\t\t<gpg.passphrase>...passphrase...</gpg.passphrase>\r\n        \t\t\t</properties>\r\n        \t\t</profile>\r\n        \t</profiles>\r\n        </settings>\r\n\r\n* Make sure you have git >= v1.7.10 installed, otherwise you may face [this bug#341221](https://bugs.eclipse.org/bugs/show_bug.cgi?id=341221).\r\n* You need to put JAXB API >= v2.2.3 to `endorsed` directory of JDK which is used to build the project. Otherwise build will fail with `java.lang.NoSuchMethodError: javax.xml.bind.annotation.XmlElementWrapper.required()Z`.\r\n* For Hudson freestyle job specify:\r\n  * Pre-release step `git checkout master; git reset --hard origin/master` (see [Can't get automated release working with Hudson + Git + Maven Release Plugin](http://stackoverflow.com/questions/1877027) for more details about the problem).\r\n  * Next step (release): `release:prepare release:perform -Pstage-release,gpg -Dresume=false -Dusername=<github_user> -Dpassword=<github_password>`\r\n\r\n### Algorithm description\r\n\r\nThe plugin flow consists of the following parts:\r\n\r\n* Parse arguments.\r\n* Find classes which are candidates for removal:\r\n  1. The candidate class should not extend any other class (as the total number of properties will be more than 1)\r\n  2. The candidate class should have exactly one non-static property.\r\n  3. This property should be a collection.\r\n  4. This collection should have exactly one parametrisation type.\r\n  5. This parametrisation type should not be `java.lang.Object` / `java.io.Serializable`.\r\n* Visit all classes again to check if the candidate is not eligible for removal:\r\n  1. If there are classes that extend the candidate\r\n  2. If there are class fields, that refer the candidate by e.g. `@XmlElementRef` annotation\r\n* Visit all classes again to replace the property having the candidate class type with collection plus `@XmlElementWrapper` annotation. On this step getters/setters are update and ObjectFactory methods are corrected. Also lazy initialization policy is applied.\r\n* Candidates which are still marked for removal are finally removed (and ObjectFactory is updated accordingly).\r\n\r\nThere are many pitfalls in JAXB Code Model API, which are forcing the developer to use dirty tricks (like accessing private fields) in order to implement the manipulation of code model. Among others:\r\n\r\n* [JAXB-784](http://java.net/jira/browse/JAXB-784) is about NPE in `JAnnotationUse#getAnnotationMembers()` method.\r\n* [JAXB-884](https://java.net/jira/browse/JAXB-884) is about ClassCastException in `JAnnotationArrayMember#annotations()` method. \r\n* [JAXB-878](https://java.net/jira/browse/JAXB-878) and [JAXB-879](https://java.net/jira/browse/JAXB-879) describe the lack of public getters for class fields.\r\n* [JAXB-957](https://java.net/jira/browse/JAXB-957) mentions what need to be added to make it possible for the inner class to be moved to another class or package. \r\n* [JAXB-883](http://java.net/jira/browse/JAXB-883) does not allow to learn if \"simpleMode\" setting is enabled, which in its turn controls plural form for collection property names. There are however some more difficulties to overcome.\r\n\r\n## Authors\r\n\r\nOriginal code by [Bjarne Hansen](http://www.conspicio.dk/blog/bjarne/jaxb-xmlelementwrapper-plugin). Many thanks to committers:\r\n\r\n* [Dmitry Katsubo](http://www.linkedin.com/in/dkatsubo)\r\n* [Tobias Warneke](https://github.com/wumpz/)\r\n* [David Matheson](https://github.com/davidfmatheson/)\r\n* [Sebastian Steiner](https://github.com/sebisteiner/)\r\n* [Colin Fairless](https://github.com/colin-yell/)\r\n* [Patrick Crocker](https://github.com/patrickcrocker/)\r\n* and others...\r\n\r\n## License\r\n\r\nThe whole project is licensed under [LGPLv3](http://www.gnu.org/licenses/lgpl-3.0.html) (or any later version).\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}